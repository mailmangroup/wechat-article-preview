!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.articlePreview=t()}(this,function(){"use strict";function e(e){var t=e.toLowerCase().replace(/ /g,"");return t}function t(e,t){var i,a={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i]);return a}function i(e,t,i){return e=document.createElement(e),t&&(e.className=t),i&&i.appendChild(e),e}function a(n){var c=this;if(this.el=document.createElement("iframe"),this.el.id="article-preview",this.el.style.border="none",this.el.style.backgroundColor="#F3F3F3",this.el.style.maxWidth="100%",this.el.style.maxHeight="100%",!(this instanceof a))throw new TypeError("Preview constructor cannot be called as a function.");var n=t({container:"iphone4"},n);if("object"==typeof n.container&&n.container.width&&n.container.height)"number"==typeof n.container.width&&"number"==typeof n.container.height&&(n.container.width=n.container.width+"px",n.container.height=n.container.height+"px"),this.el.style.width=n.container.width,this.el.style.height=n.container.height;else{if("string"!=typeof n.container)throw new TypeError("Container object contains invalid values");for(var h in r)r.hasOwnProperty(h)&&h==e(n.container)&&(this.el.style.width=r[h].width,this.el.style.height=r[h].height)}this.mainWrapper=i("div","rich_media_inner"),this.pageContent=i("div","preview-page-content",this.mainWrapper),this.mediaAreaPrimary=i("div","rich_media_area_primary",this.pageContent),this.articleTitleEl=i("h2","rich_media_title",this.mediaAreaPrimary),this.articleMetaList=i("div","rich_media_meta_list",this.mediaAreaPrimary),this.articleDateEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.articleAuthorEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.accountNameEl=i("em","rich_media_meta rich_media_meta_link rich_media_meta_nickname",this.articleMetaList),this.accountNameSpan=i("span","rich_media_meta rich_media_meta_text rich_media_meta_nickname",this.articleMetaList),this.contentWrapper=i("div","rich_media_content ",this.mediaAreaPrimary),this.articleMetaData=i("div","rich_media_tool",this.mediaAreaPrimary),this.readMoreEl=i("a","rich_media_meta",this.articleMetaData),this.articlePageviews=i("p","rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleLikesIcon=i("i","article-like-icon",this.articleMetaData),this.articleLikes=i("p","article-likes rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleReport=i("p","article-report rich_media_meta rich_media_meta_text",this.articleMetaData),this.clearFix=i("div","clearfix",this.articleMetaData),this.el.addEventListener("load",function(){if(c.previous||(c.el.contentWindow.document.open(),c.el.contentWindow.document.write("<!DOCTYPE html>"),c.el.contentWindow.document.write("<html>"),c.el.contentWindow.document.write('<head><meta charset="utf-8"></head>'),c.el.contentWindow.document.write("<body></body>"),c.el.contentWindow.document.write("</html>"),c.el.contentWindow.document.close()),c.mainWrapper.parentNode||c.el.contentWindow.document.body.appendChild(c.mainWrapper),!t){var e=c.el.contentWindow.document.getElementsByTagName("head")[0],t="http://mailmangroup.github.io/wechat-article-preview/dist/preview.css",i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,e.appendChild(i)}}),this.generate=function(e){if(this.previous)var e=t(this.previous,e);else var e=t({articleTitle:"输入标题",articleTime:Date.now(),articleAuthor:null,accountName:"账户名称",html:"开始写作",pageViews:0,pageLikes:0,readMore:!1},e);this.previous&&this.previous.articleTitle==e.articleTitle||(this.articleTitleEl.innerHTML=e.articleTitle),this.previous&&this.previous.accountNameEl==e.accountNameEl||(this.accountNameEl.innerHTML=e.accountName),this.previous&&this.previous.articleAuthorEl==e.articleAuthorEl||(this.articleAuthorEl.innerHTML=e.articleAuthor),this.previous&&this.previous.accountNameSpan==e.accountNameSpan||(this.accountNameSpan.innerHTML=e.accountName),this.previous&&this.previous.articlePageviews==e.articlePageviews||(this.articlePageviews.innerHTML="阅读 "+e.pageViews),this.previous&&this.previous.articleLikes==e.articleLikes||(this.articleLikes.innerHTML=e.pageLikes),e.readMore&&(this.readMoreEl.innerHTML="阅读原文",this.readMoreEl.setAttribute("target","_blank"),this.readMoreEl.setAttribute("href",e.readMore)),this.articleReport.innerHTML||(this.articleReport.innerHTML="举报"),this.contentWrapper.innerHTML=e.html;for(var a=this.contentWrapper.getElementsByClassName("video_iframe"),r=0;r<a.length;r++){var n=i("div","video-description"),c=a[r].getAttribute("data-src");if(a[r].parentNode.insertBefore(n,a[r].nextSibling),c){var h=c.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((v\.qq)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g);h&&(n.innerHTML="腾讯视频")}}var o=new Date(e.articleTime),s=o.getDate(),l=o.getMonth()+1,m=o.getFullYear();9>=s&&(s="0"+s),9>=l&&(l="0"+l),e.articleTime=m+"-"+l+"-"+s,this.articleDateEl.innerHTML=e.articleTime;for(var d=this.contentWrapper.querySelectorAll("[data-src]"),r=0;r<d.length;r++)d[r].src=d[r].getAttribute("data-src"),"IMG"==d[r].tagName&&(d[r].src=d[r].src.replace(/\/[0-9](?=\?wx)/,"/640"),d[r].style.height="auto");this.previous=e}}var r={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return a});