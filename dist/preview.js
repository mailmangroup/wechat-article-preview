!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.articlePreview=t()}(this,function(){"use strict";function e(e){var t=e.toLowerCase().replace(/ /g,"");return t}function t(e,t){var i,a={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i]);return a}function i(e,t,i){return e=document.createElement(e),t&&(e.className=t),i&&i.appendChild(e),e}function a(n){if(this.el=document.createElement("iframe"),this.el.id="article-preview",this.el.style.border="none",this.el.style.backgroundColor="#F3F3F3",this.el.style.maxWidth="100%",this.el.style.maxHeight="100%",!(this instanceof a))throw new TypeError("Preview constructor cannot be called as a function.");var n=t({container:"iphone4"},n);if("object"==typeof n.container&&n.container.width&&n.container.height)"number"==typeof n.container.width&&"number"==typeof n.container.height&&(n.container.width=n.container.width+"px",n.container.height=n.container.height+"px"),this.el.style.width=n.container.width,this.el.style.height=n.container.height;else{if("string"!=typeof n.container)throw new TypeError("Container object contains invalid values");for(var c in r)r.hasOwnProperty(c)&&c==e(n.container)&&(this.el.style.width=r[c].width,this.el.style.height=r[c].height)}this.mainWrapper=i("div","rich_media_inner"),this.pageContent=i("div","preview-page-content",this.mainWrapper),this.mediaAreaPrimary=i("div","rich_media_area_primary",this.pageContent),this.articleTitleEl=i("h2","rich_media_title",this.mediaAreaPrimary),this.articleMetaList=i("div","rich_media_meta_list",this.mediaAreaPrimary),this.articleDateEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.articleAuthorEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.accountNameEl=i("em","rich_media_meta rich_media_meta_link rich_media_meta_nickname",this.articleMetaList),this.accountNameSpan=i("span","rich_media_meta rich_media_meta_text rich_media_meta_nickname",this.articleMetaList),this.contentWrapper=i("div","rich_media_content ",this.mediaAreaPrimary),this.articleMetaData=i("div","rich_media_tool",this.mediaAreaPrimary),this.readMoreEl=i("a","rich_media_meta",this.articleMetaData),this.articlePageviews=i("p","rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleLikesIcon=i("i","article-like-icon",this.articleMetaData),this.articleLikes=i("p","article-likes rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleReport=i("p","article-report rich_media_meta rich_media_meta_text",this.articleMetaData),this.clearFix=i("div","clearfix",this.articleMetaData),this.generate=function(e){var a=this;if(this.el.addEventListener("load",function(e){if(a.previous||(a.el.contentWindow.document.open(),a.el.contentWindow.document.write("<!DOCTYPE html>"),a.el.contentWindow.document.write("<html>"),a.el.contentWindow.document.write('<head><meta charset="utf-8"></head>'),a.el.contentWindow.document.write("<body></body>"),a.el.contentWindow.document.write("</html>"),a.el.contentWindow.document.close()),a.mainWrapper.parentNode||a.el.contentWindow.document.body.appendChild(a.mainWrapper),!i){var t=a.el.contentWindow.document.getElementsByTagName("head")[0],i="http://mailmangroup.github.io/wechat-article-preview/dist/preview.css",r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=i,t.appendChild(r)}}),this.previous)var e=t(this.previous,e);else var e=t({articleTitle:"输入标题",articleTime:Date.now(),articleAuthor:null,accountName:"账户名称",html:"开始写作",pageViews:0,pageLikes:0,readMore:!1},e);this.previous&&this.previous.articleTitle==e.articleTitle||(this.articleTitleEl.innerHTML=e.articleTitle),this.previous&&this.previous.accountNameEl==e.accountNameEl||(this.accountNameEl.innerHTML=e.accountName),this.previous&&this.previous.articleAuthorEl==e.articleAuthorEl||(this.articleAuthorEl.innerHTML=e.articleAuthor),this.previous&&this.previous.accountNameSpan==e.accountNameSpan||(this.accountNameSpan.innerHTML=e.accountName),this.previous&&this.previous.articlePageviews==e.articlePageviews||(this.articlePageviews.innerHTML="阅读 "+e.pageViews),this.previous&&this.previous.articleLikes==e.articleLikes||(this.articleLikes.innerHTML=e.pageLikes),e.readMore&&(this.readMoreEl.innerHTML="阅读原文",this.readMoreEl.setAttribute("target","_blank"),this.readMoreEl.setAttribute("href",e.readMore)),this.articleReport.innerHTML||(this.articleReport.innerHTML="举报"),this.contentWrapper.innerHTML=e.html;for(var r=this.contentWrapper.getElementsByClassName("video_iframe"),n=0;n<r.length;n++){var c=i("div","video-description"),h=r[n].getAttribute("data-src");if(r[n].parentNode.insertBefore(c,r[n].nextSibling),h){var o=h.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((v\.qq)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g);o&&(c.innerHTML="腾讯视频")}}var s=new Date(e.articleTime),l=s.getDate(),m=s.getMonth()+1,d=s.getFullYear();9>=l&&(l="0"+l),9>=m&&(m="0"+m),e.articleTime=d+"-"+m+"-"+l,this.articleDateEl.innerHTML=e.articleTime;for(var p=this.contentWrapper.querySelectorAll("[data-src]"),n=0;n<p.length;n++)p[n].src=p[n].getAttribute("data-src"),"IMG"==p[n].tagName&&(p[n].src=p[n].src.replace(/\/[0-9](?=\?wx)/,"/640"),p[n].style.height="auto");this.previous=e}}var r={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return a});