!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.articlePreview=t()}(this,function(){"use strict";function e(e){var t=e.toLowerCase().replace(/ /g,"");return t}function t(e,t){var i,a={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i]);return a}function i(e,t,i){return e=document.createElement(e),t&&(e.className=t),i&&i.appendChild(e),e}function a(n){var s=this;if(this.el=document.createElement("iframe"),this.el.id="article-preview",this.el.style.border="none",this.el.style.backgroundColor="#F3F3F3",this.el.style.maxWidth="100%",this.el.style.maxHeight="100%",!(this instanceof a))throw new TypeError("Preview constructor cannot be called as a function.");var n=t({container:"iphone4"},n);if(this.cssFilePath=n.cssFilePath,"object"==typeof n.container&&n.container.width&&n.container.height)"number"==typeof n.container.width&&"number"==typeof n.container.height&&(n.container.width=n.container.width+"px",n.container.height=n.container.height+"px"),this.el.style.width=n.container.width,this.el.style.height=n.container.height;else{if("string"!=typeof n.container)throw new TypeError("Container object contains invalid values");for(var o in r)r.hasOwnProperty(o)&&o==e(n.container)&&(this.el.style.width=r[o].width,this.el.style.height=r[o].height)}this.mainWrapper=i("div","rich_media_inner"),this.pageContent=i("div","preview-page-content",this.mainWrapper),this.mediaAreaPrimary=i("div","rich_media_area_primary",this.pageContent),this.articleTitleEl=i("h2","rich_media_title",this.mediaAreaPrimary),this.articleMetaList=i("div","rich_media_meta_list",this.mediaAreaPrimary),this.articleDateEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.articleAuthorEl=i("em","rich_media_meta rich_media_meta_text",this.articleMetaList),this.accountNameEl=i("em","rich_media_meta rich_media_meta_link rich_media_meta_nickname",this.articleMetaList),this.accountNameSpan=i("span","rich_media_meta rich_media_meta_text rich_media_meta_nickname",this.articleMetaList),this.contentWrapper=i("div","rich_media_content ",this.mediaAreaPrimary),this.articleMetaData=i("div","rich_media_tool",this.mediaAreaPrimary),this.readMoreEl=i("a","rich_media_meta",this.articleMetaData),this.articlePageviews=i("p","rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleLikesIcon=i("i","article-like-icon",this.articleMetaData),this.articleLikes=i("p","article-likes rich_media_meta rich_media_meta_text",this.articleMetaData),this.articleReport=i("p","article-report rich_media_meta rich_media_meta_text",this.articleMetaData),this.clearFix=i("div","clearfix",this.articleMetaData),this.el.addEventListener("load",function(){if(s.previous||(s.el.contentWindow.document.open(),s.el.contentWindow.document.write("<!DOCTYPE html>"),s.el.contentWindow.document.write("<html>"),s.el.contentWindow.document.write('<head><meta charset="utf-8"></head>'),s.el.contentWindow.document.write("<body></body>"),s.el.contentWindow.document.write("</html>"),s.el.contentWindow.document.close()),s.mainWrapper.parentNode&&s.mainWrapper.parentNode===s.el.contentWindow.document.body||s.el.contentWindow.document.body.appendChild(s.mainWrapper),!t){var e=s.el.contentWindow.document.getElementsByTagName("head")[0],t=s.cssFilePath||"//mailmangroup.github.io/wechat-article-preview/dist/preview.css",i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,e.appendChild(i)}}),this.generate=function(e){if(this.previous)var e=t(this.previous,e);else var e=t({articleTitle:"输入标题",articleTime:Date.now(),articleAuthor:null,accountName:"账户名称",html:"开始写作",pageViews:0,pageLikes:0,readMore:!1},e);!e.articleTitle||this.previous&&this.previous.articleTitle===e.articleTitle?e.articleTitle||(this.articleTitleEl.innerHTML="输入标题"):this.articleTitleEl.innerHTML=e.articleTitle,!e.accountName||this.previous&&this.previous.accountName===e.accountName?e.accountName||(this.accountNameSpan.innerHTML="账户名称",this.accountNameEl.innerHTML="账户名称"):(this.accountNameSpan.innerHTML=e.accountName,this.accountNameEl.innerHTML=e.accountName),!e.articleAuthor||this.previous&&this.previous.articleAuthor===e.articleAuthor?e.articleAuthor||(this.articleAuthorEl.innerHTML=""):this.articleAuthorEl.innerHTML=e.articleAuthor,!e.pageViews||this.previous&&this.previous.pageViews===e.pageViews?e.pageViews||(this.articlePageviews.innerHTML="阅读 0"):this.articlePageviews.innerHTML="阅读 "+e.pageViews,!e.pageLikes||this.previous&&this.previous.pageLikes===e.pageLikes?e.pageLikes||(this.articleLikes.innerHTML=0):this.articleLikes.innerHTML=e.pageLikes,e.readMore?(this.readMoreEl.innerHTML="阅读原文",this.readMoreEl.setAttribute("target","_blank"),/^(http:\/\/){1,7}\S+/.test(e.readMore)===!1&&(e.readMore="http://"+e.readMore),this.readMoreEl.setAttribute("href",e.readMore)):this.readMoreEl.innerHTML="",this.articleReport.innerHTML||(this.articleReport.innerHTML="举报"),!e.html||this.previous&&this.previous.html===e.html?e.html&&""!==e.html||(this.contentWrapper.innerHTML="开始写作"):this.contentWrapper.innerHTML=e.html;for(var a=this.contentWrapper.getElementsByClassName("video_iframe"),r=0;r<a.length;r++){var n=i("div","video-description"),s=a[r].getAttribute("data-src");if(a[r].parentNode.insertBefore(n,a[r].nextSibling),s){var o=s.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((v\.qq)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g);o&&(n.innerHTML="腾讯视频")}}var c=new Date("number"==typeof e.articleTime?Number(e.articleTime):Date.now()),l=c.getDate(),h=c.getMonth()+1,m=c.getFullYear();9>=l&&(l="0"+l),9>=h&&(h="0"+h),e.articleTime=m+"-"+h+"-"+l,this.articleDateEl.innerHTML=e.articleTime;for(var d=this.contentWrapper.querySelectorAll("[data-src]"),r=0;r<d.length;r++)d[r].src=d[r].getAttribute("data-src"),"IMG"==d[r].tagName&&(d[r].src=d[r].src.replace(/\/[0-9](?=\?wx)/,"/640"),d[r].style.height="auto");for(var p=this.contentWrapper.getElementsByClassName("vote_iframe"),r=0;r<p.length;r++){var u=p[r];u.removeAttribute("src"),u.getAttribute("data-display-style")&&u.setAttribute("style",u.getAttribute("data-display-style")),u.classList.contains("vote_iframe")&&u.contentDocument&&u.addEventListener("load",function(){if(0===u.contentDocument.body.children.length){var e=document.createElement("div"),t=document.createElement("p");u.contentDocument.body.style.margin="0",e.classList.add("fn-not-available"),e.style.backgroundColor="#F2F2F2",e.style.position="absolute",e.style.height="100%",e.style.width="100%",e.style.top="0",e.style.left="0",t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.transform="translate( -50%, -50% )",t.style.margin="0",t.style.fontFamily="'Open Sans', Helvetica, sans-serif",t.innerHTML="Poll preview not available.",e.appendChild(t),u.contentDocument.body.appendChild(e)}})}this.previous=e}}var r={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return a});